@using JitDalshe.Ui.Admin.Components.Shared.Cards
@using JitDalshe.Ui.Admin.Models
@using JitDalshe.Ui.Admin.Services.EventService
@using JitDalshe.Ui.Admin.Services.ModalService
@inject IModalService ModalService
@inject IEventService EventService
@inject IToastService ToastService

<Card HeaderText="@CardHeaderText"
      Title="@Event.Title"
      Buttons="Card.Button.Info | Card.Button.Edit | Card.Button.Delete"
      OnInfoButtonClick="@ShowInfoEventModalAsync"
      OnEditButtonClick="@ShowEditEventModalAsync"
      OnDeleteButtonClick="@DeleteEventAsync"/>

<EditEventModal Id="@EditEventModalId" Event="@Event" EventEdited="@OnEventEditedCallback"/>
<InfoEventModal Id="@InfoEventModalId" Event="Event"/>

@code {

    private string CardHeaderText => $"{Event.Date.ToString("dd-MM-yyyy")} ({Event.DisplayingStatus})";
    private string EditEventModalId => $"modal_edit_event_{Event.Id}";
    private string InfoEventModalId => $"modal_info_event_{Event.Id}";

    [Parameter] public required Event Event { get; init; }
    [Parameter] public required EventCallback OnEventEditedCallback { get; init; }
    [Parameter] public required EventCallback OnEventDeletedCallback { get; init; }

    private Task ShowInfoEventModalAsync()
        => ModalService.ShowModalAsync($"#{InfoEventModalId}");

    private Task ShowEditEventModalAsync()
        => ModalService.ShowModalAsync($"#{EditEventModalId}");

    private async Task DeleteEventAsync()
    {
        if (await EventService.DeleteEventAsync(Event.Id))
        {
            ToastService.ShowSuccess("Событие успешно удалено");
            await OnEventDeletedCallback.InvokeAsync();
        }
    }

}